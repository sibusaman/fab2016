<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">

  <link rel="stylesheet" type="text/css" href="../stylesheets/stylesheet.css" media="screen">
  <link rel="stylesheet" type="text/css" href="../stylesheets/github-dark.css" media="screen">
  <link rel="stylesheet" type="text/css" href="../stylesheets/print.css" media="print">
  <link rel="stylesheet" href="../stylesheets/mine.css">
  <link rel="stylesheet" href="cssgal.css">
  <title>6:-Electronics Design</title>
</head>

<body>
  <link rel="icon" type="image/png" href="../favicon.png">
  <header>
    <div class="container">
      <h1>Fab2016</h1>
      <h3>/ Module 6</h3>

      <section id="Module">
        <a href="../index.html">Home</a>
        <a href="../w1/w1.html" class="btn" title="Principles and Practices, Project Management ">1</a>
        <a href="../w2/w2.html" class="btn" title="Computer-Aided Design">2</a>
        <a href="../w3/w3.html" class="btn" title="Computer-Controlled Cutting">3</a>
        <a href="../w4/w4.html" class="btn" title="Electronics Production">4</a>
        <a href="../w5/w5.html" class="btn" title="3D Scanning and Printing">5</a>
        <a href="../w6/w6.html" class="btn" title="Electronics Design">6</a>
        <a href="../w7/w7.html" class="btn" title="Computer-Controlled Machining">7</a>
        <a href="../w8/w8.html" class="btn" title="Embedded Programming">8</a>
        <a href="../w9/w9.html" class="btn" title="Mechanical Design">9</a>
        <a href="../w10/w10.html" class="btn" title="Machine Design">10</a>
        <a href="../w11/w11.html" class="btn" title="Input Devices">11</a>
        <a href="../w12/w12.html" class="btn" title="Molding and Casting">12</a>

      </section>
    </div>
  </header>
  <section>

    <h1>Electronics Design</h1>
    <p>
      The target of this module is to introduce PCB designing.
      <br> I have already done a few circuit designs, rather redesigned a the Fab-ISP key version to include two LEDs and replaces the crystal and two capacitors with a resonator. The documentation
      is available at
      <a href="../w4/w4.html">here</a>.
    </p>
    <p>
      <a href="http://www.cadsoftusa.com/">EAGLE</a> is the preferred PCB design tool for me. I have been using this tool for some time. I have used a few other tools before, like
      <a href="http://www.sunstone.com/pcb-products/pcb123">PCB123</a>,
      <a href="http://kicad-pcb.org/">KiCAD</a> and I have a little bit of experience with
      <a href="https://github.com/mkeeter/kokopelli">Kokopelli</a>.
    </p>
    <p>
      <h4>These are the Eagle Files for the FabISP-Key redesigned with LEDs.</h4>
      <br>
      <a href="../w4/s-ispv2.brd" download="sibu-FabISPwLED-v2.brd">Board-v2</a>
      <a href="../w4/s-ispv2.sch" download="sibu-FabISPwLED-v2.sch">Schematic-v2</a>
    </p>
    <p>
      There are few more designs I made for different various purposes. One such project is about making a
      <a href="http://sibusaman.github.io/DIY-Soldering-Station/">DIY Soldering Station</a>, basically a controller for the Weller PES51 pencil. I designed an PCB which
      <ol>
        <li>Will amplify the signals from temperature sensor in the Pencil, </li>
        <li>Has a MOSFET to control the power delivered to the pencil, </li>
        <li>Has an NTC temperature sensor for getting the room temperature for accurate control of the iron.</li>
      </ol>
      <br>
      <br>
      <h4>Pictures</h4>
      <br>
      <figure>
        <img src="sch.png" alt="schematic" width="500" onmouseover="this.width='1300'" onmouseout="this.width='500'">
        <figcaption style="display:inline; color:grey"> The schematic of the amplifier board."</figcaption>

        <img src="brd.png" alt="sch brd" width="500" onmouseover="this.width='1300'" onmouseout="this.width='500'">
        <figcaption style="display:inline; color:grey">The top layer of the board (bottom is just a ground plane, no traces. The outer rectangle is drawn in milling layer and this will be used to cutout the board after milling.</figcaption>
      </figure>
      <br> An interesting video of the component placement and routing.
      <br>
      <video width="520" controls>
        <source src="redesign.mp4" type="video/mp4"> Your browser does not support the video tag.
      </video>
      <br>
      <figure>
        <img src="pop%20top.JPG" alt="populated board top" width="500" onmouseover="this.width='900'" onmouseout="this.width='500'">
        <figcaption style="display:inline; color:grey">The amplifier/control board populated with all components (except few wires and the NTC sensor section at bottom left).</figcaption>

        <img src="pop%20bot.JPG" alt="populated board bottom" width="500" onmouseover="this.width='900'" onmouseout="this.width='500'">
        <figcaption style="display:inline; color:grey">Bottom side of the same board, you can see the 'DIY' interconnects. Well, whats with the texture you may ask; I used sand-blaster it, why not?. It had lot of fingerprints and
          other dirt on it, so 'I did what I have to do'. (or!!! what I wanted to do). And YES, this is a double sided PCB.
        </figcaption>
      </figure>
      <h4>EAGLE Files for the Amplifier Board</h4>
      <br>
      <a href="sold.sch" download="sold-stn-amp-brd.sch">Schematic.</a>
      <a href="sold.brd" download="sold-stn-amp-brd.brd">Board.</a>
      <br>
      <br> The work is still in progress, but progress is slow. The hardware is mostly over and what is left is the firmware. I have also designed a compact Arduino-UNO compatible (only
      software, no hardware/pin compatibility) micro-controller board for use in the soldering station.
      <br>
      <figure>
        <img src="sduino.png" alt="sduino-eagle image" width="500" onmouseover="this.width='900'" onmouseout="this.width='500'" />
        <figcaption style="display:inline; color:grey">The Eagle snapshot of Fabduino variant I made.</figcaption>
      </figure>
      <br>
      <h4>EAGLE Files are here</h4>
      <br>
      <a href="sduino.brd" download="sibu-sduino.brd">Board</a>
      <a href="sduino.sch" download="sibu-sduino.sch">Schematic</a>
    </p>
    <p>
      The pictures are here.
      <figure>
        <img src="sd1.jpg" alt="sduino-top" width="500" onmouseover="this.width='900'" onmouseout="this.width='500'" />
        <figcaption style="display:inline; color:grey">The top of the board.</figcaption>
        <br>
        <img src="sd2.jpg" alt="sduino-bot" width="500" onmouseover="this.width='900'" onmouseout="this.width='500'" />
        <figcaption style="display:inline; color:grey">The bottom, with the power rails and the ISP connector.</figcaption>
      </figure>
      <br> I planned a proper double sided PCB with VCC and GND rails in the bottom layer. Since I had piece of single sided PCB laying around which is just enough for this board, so I
      made the top layer from that board and made the funny looking rails for VCC and GND. The ISP connector has been mirrored so that it is on the bottom layer. The long rail with
      lot of connection is GND and th other one is obviously VCC.
    </p>
    <h3>Programming a 20MHz board.</h3>
    <p>
      This is not compatible with any of the standard Arduino boards, because this board uses a 20MHz resonator. All the standard Arduinos using Atmega328p is running at either 26MHz or at
      8MHz. It was my first time making a custom Micro-controller board. So I looked around to see who else has made a 20MHz version, many Fabduinos are like this, so someone must have
      the required instructions.
      <br> I found a page of a previous fab academy student
      <a href="http://fab.cba.mit.edu/classes/863.13/people/amir/work/week8.html">Amir Lazarovich</a>, he made a 20MHz Fabduino and he shared the required files, the <code>Makefile</code>, the <code>boards.txt</code> file and the bootloader. I used these files
      to program my board, I copies the boards definition from this file and added a few on my own, these definitions were appended to <code>~/.arduino15/packages/arduino/hardware/avr/1.6.10/boards.txt</code>.
      Similarly I modified the Makefile located at <code>~/.arduino15/packages/arduino/hardware/avr/1.6.10/bootloaders/atmega/</code> to suit the new board.
    </p>
    <p>
      Though the documentation by Amir was really helpful, I couldn't get the Arduino IDE to program my board, I was getting an error <code>Error while uploading: missing 'upload.tool' configuration parameter</code>.
      Then I found
      <a href="this page">https://github.com/arduino/Arduino/wiki/Arduino-Hardware-Cores-migration-guide-from-1.0-to-1.6</a> and I followed this to edit my boards.txt file further. This was due to some
      additional requirement by the new Arduino IDE. Finally I could program my board using my
      <a href="../w4/w4.html">UsbTiny-FabISP</a>.
      <br> This is a video of the board being programmed I made for
      <a href="../w4/w4.html">Electronics Production</a> Week.
      <br>
      <video width="620" controls>
        <source src="../w4/isp prog.m4v" type="video/mp4"> Your browser does not support the video tag.
      </video>
      <br>
      <h4>The Makefile, boards.txt and the hex file can be downloaded below. The location of the files as in my system is also shown.</h4>
      <br>
      <a href="Makefile" download="Makefile">~/.arduino15/packages/arduino/hardware/avr/1.6.10/bootloaders/atmega/Makefile</a>
      <br>
      <a href="boards.txt" download="boards.txt">~/.arduino15/packages/arduino/hardware/avr/1.6.10/boards.txt</a>
      <br>
      <a href="ATmegaBOOT_168_atmega328_pro_20MHz.hex" download="ATmegaBOOT_168_atmega328_pro_20MHz.hex">~/.arduino15/packages/arduino/hardware/avr/1.6.10/bootloaders/atmega/ATmegaBOOT_168_atmega328_pro_20MHz.hex</a>
    </p>
    <p>
      <h4>Few Resources I Found Useful</h4>
      <br>
      <ul>
        <li>
          <a href="http://www.grozeaion.com/electronics/arduino/155-overclocking-atmega328p">Overclocking ATMega328P</a>
        </li>
        <li>
          <a href="http://www.grozeaion.com/electronics/arduino/131-atmega328p-burning-bootloader.html">ATMega328P - Burning bootloader</a>
        </li>
        <li>
          <a href="http://www.avrfreaks.net/forum/tutsoft-recovering-locked-out-avr?name=PNphpBB2&file=viewtopic&t=106325">Recovering from a "locked out" AVR</a>
        </li>
      </ul>
    </p>
    <h2 style="color:red">The Arduino Permission Fix</h2>
    <p>
      You may find that you can't use Arduino IDE to program your board unless you start IDE as 'root'. There is a fix for this.
    </p>
    <p>
      After installing the Arduino IDE in Arch or Arch based Distros like Manjaro, you need to add yourself to a few groups so that you can access serial devices.
      <br>
      <code>gpasswd -a $USER uucp</code>
      <br>
      <code>gpasswd -a $USER lock</code>
    </p>
    <p>
      <b>Define the correct udev.rules</b>. For the Arch based distribution which I use, I created a file <code>/etc/udev/rules.d/50-embedded_devices.rules</code>
      <pre>
# USBtinyISP Programmer rules
SUBSYSTEMS=="usb", ATTRS{idVendor}=="1781", ATTRS{idProduct}=="0c9f", GROUP="users", MODE="0666"
SUBSYSTEMS=="usb", ATTRS{idVendor}=="16c0", ATTRS{idProduct}=="0479", GROUP="users", MODE="0666"

# USBasp Programmer rules http://www.fischl.de/usbasp/
SUBSYSTEMS=="usb", ATTRS{idVendor}=="16c0", ATTRS{idProduct}=="05dc", GROUP="users", MODE="0666"

# Mdfly.com Generic (SiLabs CP2102) 3.3v/5v USB VComm adapter
SUBSYSTEMS=="usb", ATTRS{idVendor}=="10c4", ATTRS{idProduct}=="ea60", GROUP="users", MODE="0666"

#Atmel AVR Dragon (dragon_isp) rules
SUBSYSTEM=="usb", ATTRS{idVendor}=="03eb", ATTRS{idProduct}=="2107", GROUP="users", MODE="0666"

#Atmel AVR JTAGICEMKII rules
SUBSYSTEM=="usb", ATTRS{idVendor}=="03eb", ATTRS{idProduct}=="2103", GROUP="users", MODE="0666"

#Atmel Corp. AVR ISP mkII
SUBSYSTEM=="usb", ATTRS{idVendor}=="03eb", ATTRS{idProduct}=="2104", GROUP="users", MODE="0666"

#Atmel Copr. JTAGICE3
SUBSYSTEM=="usb", ATTRS{idVendor}=="03eb", ATTRS{idProduct}=="2140", GROUP="users", MODE="0666"
      </pre> You can add more device IDs as you wish. Also edit the files as required for your device. For example, edit the <code>Group</code> to suit yours.
      <br> After the new rules, you need to reload the rules and make the system aware of the new rules.
      <br> For
      <b>ARCH Based Distros</b>
      <br>
      <code>udevadm control --reload</code>
      <br>
      <code>udevadm trigger</code> To manually force udev to trigger your rules.
    </p>
    <p>
      Resources
      <ul>
        <li>
          <a href="http://blog.opensensors.io/blog/2014/09/13/getting-started-with-arduino-on-linux/">Getting Started With Arduino on Linux (Ubuntu)</a>
        </li>
        <li>
          <a href="http://playground.arduino.cc/Learning/Linux">Installing Arduino on Linux</a>
        </li>
        <li>
          <a href="http://playground.arduino.cc/Linux/Ubuntu">Install Arduino on Ubuntu Linux</a>
        </li>
        <li>
          <a href="https://wiki.archlinux.org/index.php/Arduino">Arduino On Arch/Manjaro</a>
        </li>
      </ul>
    </p>
    <h3>Problems</h3>
    <p>
      I had a one major issue so far, the ISP connector is soldered on very thin pads and some pressure on the ISP pins pushed them inside, thorough the holes and the pads came off and the
      lost connection to the traces. I fixed it somehow using thin copper strands and glue gun, put it's not a good or reliable solution. A better solution would be to use a thicker
      pads or add rectangle section ion eagle to make the pads bigger, like in the figure below.
      <br>
      <img src="sduino-fix.png" alt="sduino-fix.png" width="500" onmouseover="this.width='900'" onmouseout="this.width='500'">
    </p>

    <h2>Exploring Further.</h2>
    <p>
      I know, I have done more than enough for this modules assignment. But most of the above circuits were made before or an existing design or not something unique and I have a week to
      do something, I'm exploring a few options. I have a few ideas, few things I needed, so I might be making one or more of the below list, when I get time.
      <ol>
        <li>
          A 12V lead-acid based DC UPS for the 3D printer: This is also useful (with some modification) as a Desktop UPS as the normal UPSs convert the 12V to 230 V AC and then the SMPS inside
          the PC converts it again to 12V, 5V and 3.3V. So I can improve the system efficiency if I were to use DC-DC converter to generate a stable 12V, 5V and 3.3V from the Lead-Acid
          battery directly.
        </li>
        <li>
          A servo tester, a small board that supplies PWM signals to test the servo/BLDC motor. The PWM duty cycle will be controlled by a rotary switch. Something like the one seen at
          <a href="http://www.hobbyking.com/hobbyking/store/__14774__HobbyKing_8482_Servo_Tester.html">HobbyKing</a> or this
          <a href="http://www.instructables.com/id/Simple-Servo-Tester/">Instructables</a>.
        </li>
        <li>
          A stepper tester similar to above.
        </li>
      </ol>
      <h1>EDIT:- You can continue to module 11,
        <a href="../w11/w11.html">Input Devices</a>
      </h1> where I'll be documenting the development of a single board which dues both, control the servo and the stepper, using a rotary switch.
    </p>

  </section>

</body>

</html>
